<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Onboarding Application</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-size: 13px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
    }
    input, select, textarea {
      font-family: inherit;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide Icons as inline SVG components
    const Calendar = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    );

    const Save = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
        <polyline points="17 21 17 13 7 13 7 21"></polyline>
        <polyline points="7 3 7 8 15 8"></polyline>
      </svg>
    );

    const X = ({ size = 24, className = "", strokeWidth = 2 }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth}>
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const Upload = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
    );

    const Download = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
    );

    const Plus = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Edit2 = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
      </svg>
    );

    const Trash2 = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      </svg>
    );

    const Check = ({ size = 24, className = "", strokeWidth = 2 }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth}>
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    );

    const Users = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
    );

    const TrendingUp = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
        <polyline points="17 6 23 6 23 12"></polyline>
      </svg>
    );

    const LayoutGrid = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
    );

    const Clock = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
    );

    const CalendarDays = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
        <path d="M8 14h.01"></path>
        <path d="M12 14h.01"></path>
        <path d="M16 14h.01"></path>
        <path d="M8 18h.01"></path>
        <path d="M12 18h.01"></path>
        <path d="M16 18h.01"></path>
      </svg>
    );

    const INITIAL_PRODUCTS = [
      'Maintenance Extension', 'Translation', 'Income Management', 'Income Reconciliation',
      'Updates (v14 or v15)', 'eCourt Integration', 'Payacre', 'Call Secure/Call Secure Plus',
      'Knoydart / Call Secure', 'Payment Portal', 'Stored Card', 'P2PE (TMS)',
      'eReturns', 'Touch Tone', 'Instant Payments', 'SC Payment Portal',
      'PRM-CBI', 'TP Trading Banking', 'Smart Gateway', 'Smart Mobile',
      'eSkog', 'Direct Debits', 'POPP', 'EPOS',
      'Jammie-Kelly', 'Optimize Fraud', 'ApplePay/GooglePay', 'Mobile SDK'
    ];

    const App = () => {
      const [view, setView] = useState('list');
      const [customers, setCustomers] = useState([]);
      const [products, setProducts] = useState(INITIAL_PRODUCTS);
      const [currentCustomer, setCurrentCustomer] = useState(null);
      const [step, setStep] = useState(1);
      const [formData, setFormData] = useState({
        accountInfo: { name: '', id: '', industry: '', accountManager: '' },
        products: {},
        commercial: { arr: '', contractLength: '', renewalDate: '' },
        contacts: [{ name: '', email: '', role: '' }],
        events: []
      });
      const [newProduct, setNewProduct] = useState('');
      const [showProductManager, setShowProductManager] = useState(false);
      const [selectedCustomerForEvents, setSelectedCustomerForEvents] = useState(null);
      const [showEventForm, setShowEventForm] = useState(false);
      const [editingEventIndex, setEditingEventIndex] = useState(null);
      const [selectedCustomerDetail, setSelectedCustomerDetail] = useState(null);
      const [eventFormData, setEventFormData] = useState({
        type: 'Review',
        meetingType: 'F2F',
        date: '',
        subject: '',
        notes: '',
        internalAttendees: '',
        externalAttendees: ''
      });

      useEffect(() => {
        loadData();
      }, []);

      const loadData = () => {
        try {
          const stored = localStorage.getItem('onboarding-data');
          if (stored) {
            const data = JSON.parse(stored);
            setCustomers(data.customers || []);
            setProducts(data.products || INITIAL_PRODUCTS);
          }
        } catch (e) {
          console.log('No stored data found');
        }
      };

      const saveData = (updatedCustomers, updatedProducts) => {
        try {
          localStorage.setItem('onboarding-data', JSON.stringify({
            customers: updatedCustomers || customers,
            products: updatedProducts || products
          }));
        } catch (e) {
          console.error('Save failed:', e);
        }
      };

      const addProduct = () => {
        if (newProduct && !products.includes(newProduct)) {
          const updated = [...products, newProduct];
          setProducts(updated);
          saveData(customers, updated);
          setNewProduct('');
        }
      };

      const deleteProduct = (prod) => {
        const updated = products.filter(p => p !== prod);
        setProducts(updated);
        const updatedCustomers = customers.map(c => ({
          ...c,
          products: Object.fromEntries(
            Object.entries(c.products).filter(([k]) => k !== prod)
          )
        }));
        setCustomers(updatedCustomers);
        saveData(updatedCustomers, updated);
      };

      const startOnboarding = () => {
        setFormData({
          accountInfo: { name: '', id: '', industry: '', accountManager: '' },
          products: {},
          commercial: { arr: '', contractLength: '', renewalDate: '' },
          contacts: [{ name: '', email: '', role: '' }],
          events: []
        });
        setCurrentCustomer(null);
        setStep(1);
        setView('onboard');
      };

      const editCustomer = (customer) => {
        setCurrentCustomer(customer);
        setFormData({
          accountInfo: customer.accountInfo,
          products: customer.products,
          commercial: customer.commercial,
          contacts: customer.contacts,
          events: customer.events || []
        });
        setStep(1);
        setView('onboard');
      };

      const saveCustomer = () => {
        const customer = {
          id: currentCustomer?.id || Date.now().toString(),
          ...formData,
          createdAt: currentCustomer?.createdAt || new Date().toISOString()
        };
        
        let updated;
        if (currentCustomer) {
          updated = customers.map(c => c.id === currentCustomer.id ? customer : c);
        } else {
          updated = [...customers, customer];
        }
        
        setCustomers(updated);
        saveData(updated, products);
        setView('list');
        setCurrentCustomer(null);
      };

      const deleteCustomer = (id) => {
        if (confirm('Delete this customer?')) {
          const updated = customers.filter(c => c.id !== id);
          setCustomers(updated);
          saveData(updated, products);
        }
      };

      const exportData = () => {
        const csv = [
          ['Customer Name', 'ID', 'Industry', 'Account Manager', 'ARR', 'Contract Length', 'Renewal Date', ...products],
          ...customers.map(c => [
            c.accountInfo.name, c.accountInfo.id, c.accountInfo.industry, c.accountInfo.accountManager,
            c.commercial.arr, c.commercial.contractLength, c.commercial.renewalDate,
            ...products.map(p => c.products[p] ? 'Yes' : 'No')
          ])
        ].map(row => row.join(',')).join('\n');
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'customers.csv';
        a.click();
      };

      const importData = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
          const text = event.target.result;
          const lines = text.split('\n');
          const headers = lines[0].split(',');
          
          const imported = lines.slice(1).filter(line => line.trim()).map(line => {
            const values = line.split(',');
            const prods = {};
            products.forEach((p, i) => {
              const idx = headers.indexOf(p);
              if (idx >= 0) prods[p] = values[idx]?.toLowerCase() === 'yes';
            });
            
            return {
              id: Date.now().toString() + Math.random(),
              accountInfo: {
                name: values[0] || '',
                id: values[1] || '',
                industry: values[2] || '',
                accountManager: values[3] || ''
              },
              commercial: {
                arr: values[4] || '',
                contractLength: values[5] || '',
                renewalDate: values[6] || ''
              },
              products: prods,
              contacts: [{ name: '', email: '', role: '' }],
              events: [],
              createdAt: new Date().toISOString()
            };
          });
          
          const updated = [...customers, ...imported];
          setCustomers(updated);
          saveData(updated, products);
        };
        reader.readAsText(file);
      };

      const addEvent = (customerId) => {
        if (!eventFormData.date || !eventFormData.subject) {
          alert('Please fill in date and subject');
          return;
        }

        const updated = customers.map(c => {
          if (c.id === customerId) {
            const newEvents = [...(c.events || [])];
            const eventData = {
              type: eventFormData.type,
              meetingType: eventFormData.meetingType,
              date: eventFormData.date,
              subject: eventFormData.subject,
              notes: eventFormData.notes,
              internalAttendees: eventFormData.internalAttendees,
              externalAttendees: eventFormData.externalAttendees
            };

            if (editingEventIndex !== null) {
              newEvents[editingEventIndex] = eventData;
            } else {
              newEvents.push(eventData);
            }

            return {
              ...c,
              events: newEvents
            };
          }
          return c;
        });
        
        setCustomers(updated);
        setSelectedCustomerForEvents(updated.find(c => c.id === customerId));
        saveData(updated, products);
        
        setEventFormData({
          type: 'Review',
          meetingType: 'F2F',
          date: '',
          subject: '',
          notes: '',
          internalAttendees: '',
          externalAttendees: ''
        });
        setShowEventForm(false);
        setEditingEventIndex(null);
      };

      const editEvent = (eventIndex, eventData) => {
        setEventFormData({
          type: eventData.type,
          meetingType: eventData.meetingType,
          date: eventData.date,
          subject: eventData.subject,
          notes: eventData.notes || '',
          internalAttendees: eventData.internalAttendees || '',
          externalAttendees: eventData.externalAttendees || ''
        });
        setEditingEventIndex(eventIndex);
        setShowEventForm(true);
      };

      const stepLabels = ['Account', 'Products', 'Commercial', 'Contacts', 'Review'];

      const renderList = () => (
        <div className="space-y-6">
          <div className="flex justify-between items-center">
            <div>
              <h2 className="text-2xl font-bold text-gray-800">Customer Portfolio</h2>
              <p className="text-gray-600 mt-1 text-xs uppercase tracking-wide">{customers.length} Active Accounts</p>
            </div>
            <div className="flex gap-3">
              <label className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 cursor-pointer transition-all flex items-center text-sm font-semibold uppercase tracking-wide shadow-md">
                <Upload size={16} className="inline mr-2" />
                Import
                <input type="file" accept=".csv" onChange={importData} className="hidden" />
              </label>
              <button onClick={exportData} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all flex items-center text-sm font-semibold uppercase tracking-wide shadow-md">
                <Download size={16} className="inline mr-2" />
                Export
              </button>
              <button onClick={startOnboarding} className="px-4 py-2 bg-[#E5173F] text-white rounded-lg hover:bg-[#c4132f] transition-all flex items-center text-sm font-semibold uppercase tracking-wide shadow-md">
                <Plus size={16} className="inline mr-2" />
                New Customer
              </button>
            </div>
          </div>
          
          <div className="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
            <div className="overflow-x-auto" style={{maxHeight: '75vh'}}>
              <table className="w-full">
                <thead className="bg-gradient-to-r from-gray-100 to-gray-50 sticky top-0 border-b-2 border-gray-300 z-20">
                  <tr>
                    <th className="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider sticky left-0 bg-gradient-to-r from-gray-100 to-gray-50 z-30 border-r border-gray-200">Customer</th>
                    <th className="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">ID</th>
                    <th className="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Industry</th>
                    <th className="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Account Manager</th>
                    <th className="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">ARR</th>
                    {products.map(p => (
                      <th key={p} className="px-2 py-4 text-xs font-bold text-gray-700 uppercase border-l border-gray-200" style={{minWidth: '80px', writingMode: 'vertical-rl', transform: 'rotate(180deg)'}}>
                        {p}
                      </th>
                    ))}
                    <th className="px-6 py-4 text-center text-xs font-bold text-gray-700 uppercase tracking-wider sticky right-0 bg-gradient-to-r from-gray-100 to-gray-50 z-30 border-l-2 border-gray-300">Actions</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200 bg-white">
                  {customers.map((c, idx) => (
                    <tr key={c.id} className={`hover:bg-blue-50 transition-colors ${idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}>
                      <td 
                        onClick={() => {
                          setSelectedCustomerDetail(c);
                          setView('detail');
                        }}
                        className="px-6 py-4 font-semibold text-gray-800 sticky left-0 bg-inherit z-10 border-r border-gray-200 cursor-pointer"
                      >
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 bg-gradient-to-br from-[#2A5C59] to-[#E5173F] rounded-lg flex items-center justify-center text-white font-bold shadow-sm">
                            {c.accountInfo.name.charAt(0)}
                          </div>
                          <span className="font-medium hover:text-[#2A5C59]">{c.accountInfo.name}</span>
                        </div>
                      </td>
                      <td className="px-4 py-4 text-sm text-gray-700 font-mono">{c.accountInfo.id}</td>
                      <td className="px-4 py-4 text-sm text-gray-700">{c.accountInfo.industry}</td>
                      <td className="px-4 py-4 text-sm text-gray-700">{c.accountInfo.accountManager}</td>
                      <td className="px-4 py-4 text-sm font-bold text-green-700">Â£{c.commercial.arr}</td>
                      {products.map(p => (
                        <td key={p} className="px-2 py-4 text-center border-l border-gray-200">
                          {c.products[p] ? (
                            <div className="inline-flex items-center justify-center w-7 h-7 bg-green-100 rounded-md border border-green-300">
                              <Check size={14} className="text-green-700 font-bold" strokeWidth={3} />
                            </div>
                          ) : (
                            <div className="inline-flex items-center justify-center w-7 h-7 bg-gray-100 rounded-md border border-gray-300">
                              <X size={14} className="text-gray-400" />
                            </div>
                          )}
                        </td>
                      ))}
                      <td className="px-6 py-4 sticky right-0 bg-inherit z-10 border-l-2 border-gray-300">
                        <div className="flex gap-2 justify-center">
                          <button 
                            onClick={() => {
                              setSelectedCustomerForEvents(c);
                              setView('events');
                            }}
                            className="p-2 text-[#E5173F] hover:bg-red-50 rounded-lg transition-all border border-transparent hover:border-red-200"
                            title="Manage Events"
                          >
                            <CalendarDays size={18} />
                          </button>
                          <button onClick={() => editCustomer(c)} className="p-2 text-[#2A5C59] hover:bg-teal-50 rounded-lg transition-all border border-transparent hover:border-teal-200">
                            <Edit2 size={18} />
                          </button>
                          <button onClick={() => deleteCustomer(c.id)} className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all border border-transparent hover:border-red-200">
                            <Trash2 size={18} />
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      );

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-8">
          <div className="max-w-[95%] mx-auto">
            <div className="bg-white rounded-lg shadow-xl overflow-hidden border border-gray-200">
              <div className="bg-gradient-to-r from-[#2A5C59] via-[#25081F] to-[#E5173F] p-8">
                <div className="flex justify-between items-center">
                  <div>
                    <h1 className="text-3xl font-bold text-white tracking-tight">Customer Relationship Management</h1>
                    <p className="text-gray-100 mt-2 text-sm">Enterprise Customer Portfolio & Event Management System</p>
                  </div>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setView('list')}
                      className={`px-5 py-2.5 rounded-lg font-semibold transition-all flex items-center text-sm uppercase tracking-wide ${
                        view === 'list' 
                          ? 'bg-white text-gray-800 shadow-lg' 
                          : 'bg-white/20 text-white hover:bg-white/30'
                      }`}
                    >
                      <Users size={16} className="inline mr-2" />
                      Customers
                    </button>
                  </div>
                </div>
              </div>

              <div className="p-6">
                {view === 'list' && renderList()}
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
