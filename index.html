<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Onboarding Application</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        // Simple icon components
        const Check = ({ size = 24, className = "", strokeWidth = 2 }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth}>
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );
        const X = ({ size = 24, className = "", strokeWidth = 2 }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth}>
                <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );
        const ChevronRight = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );
        const ChevronLeft = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        );

        const OnboardingApp = () => {
            const [viewMode, setViewMode] = useState('form');
            const [currentStep, setCurrentStep] = useState(0);
            const [selectedCustomer, setSelectedCustomer] = useState(null);
            const [isSubmitted, setIsSubmitted] = useState(false);
            const [onboardingId, setOnboardingId] = useState(null);
            const [showProductManager, setShowProductManager] = useState(false);
            const [newProduct, setNewProduct] = useState('');
            
            const [products, setProducts] = useState([
                'Maintenance Extension', 'Translation', 'Income Management', 'Income Reconciliation',
                'Updates (v14 or v15)', 'eCourt Integration', 'Payacre', 'Call Secure/Call Secure Plus',
                'Knoydart / Call Secure', 'Payment Portal', 'Stored Card', 'P2PE (TMS)', 'eReturns',
                'Touch Tone', 'Instant Payments', 'SC Payment Portal', 'PRM-CBI', 'TP Trading Banking',
                'Smart Gateway', 'Smart Mobile', 'eSkog', 'Direct Debits', 'POPP', 'EPOS',
                'Jammie-Kelly', 'Optimize Fraud', 'ApplePay/GooglePay', 'Mobile SDK'
            ]);

            const [formData, setFormData] = useState({
                accountName: '', accountNumber: '', industry: '', accountManager: '', products: [],
                contractValue: '', startDate: '', billingFrequency: '', paymentMethod: '',
                technicalContact: '', technicalEmail: '', businessContact: '', businessEmail: '',
                notes: '', status: 'Pending Implementation'
            });

            const industries = ['Healthcare', 'Education', 'Retail', 'Public Sector', 'Financial Services', 'Other'];
            const billingFrequencies = ['Monthly', 'Quarterly', 'Annually'];
            const paymentMethods = ['Direct Debit', 'Credit Card', 'Bank Transfer', 'Invoice'];
            const statuses = ['Pending Implementation', 'In Implementation', 'Active', 'On Hold', 'Churned'];
            const steps = [
                { title: 'Account Info', icon: '1' }, { title: 'Products', icon: '2' },
                { title: 'Commercial', icon: '3' }, { title: 'Contacts', icon: '4' }, { title: 'Review', icon: '5' }
            ];

            const handleInputChange = (field, value) => setFormData(prev => ({ ...prev, [field]: value }));
            const handleProductToggle = (product) => {
                setFormData(prev => ({
                    ...prev, products: prev.products.includes(product) ? prev.products.filter(p => p !== product) : [...prev.products, product]
                }));
            };
            const addNewProduct = () => {
                if (newProduct.trim() && !products.includes(newProduct.trim())) {
                    setProducts([...products, newProduct.trim()]);
                    setNewProduct('');
                }
            };
            const removeProduct = (productToRemove) => {
                setProducts(products.filter(p => p !== productToRemove));
                setFormData(prev => ({ ...prev, products: prev.products.filter(p => p !== productToRemove) }));
            };

            const nextStep = () => { if (currentStep < steps.length - 1) setCurrentStep(currentStep + 1); };
            const prevStep = () => { if (currentStep > 0) setCurrentStep(currentStep - 1); };

            const handleSubmit = () => {
                const newId = 'ONB-' + Date.now().toString().slice(-8);
                setOnboardingId(newId);
                const onboardingData = { id: newId, ...formData, submittedAt: new Date().toISOString() };
                const existingData = JSON.parse(localStorage.getItem('onboardings') || '[]');
                existingData.push(onboardingData);
                localStorage.setItem('onboardings', JSON.stringify(existingData));
                setIsSubmitted(true);
            };

            const resetForm = () => {
                setFormData({
                    accountName: '', accountNumber: '', industry: '', accountManager: '', products: [],
                    contractValue: '', startDate: '', billingFrequency: '', paymentMethod: '',
                    technicalContact: '', technicalEmail: '', businessContact: '', businessEmail: '',
                    notes: '', status: 'Pending Implementation'
                });
                setCurrentStep(0); setIsSubmitted(false); setOnboardingId(null); setViewMode('form');
            };

            const getAllOnboardings = () => JSON.parse(localStorage.getItem('onboardings') || '[]');
            const saveCustomerEvents = (customerId, events) => {
                const allEvents = JSON.parse(localStorage.getItem('customerEvents') || '{}');
                allEvents[customerId] = events;
                localStorage.setItem('customerEvents', JSON.stringify(allEvents));
            };
            const getCustomerEvents = (customerId) => {
                const allEvents = JSON.parse(localStorage.getItem('customerEvents') || '{}');
                return allEvents[customerId] || [];
            };

            const generateSampleData = () => {
                const sampleCompanies = [
                    { name: 'Acme Healthcare Ltd', industry: 'Healthcare', manager: 'Sarah Johnson', value: 125000, products: ['Income Management', 'Payment Portal', 'Direct Debits', 'Instant Payments'] },
                    { name: 'Brighton Council', industry: 'Public Sector', manager: 'Michael Chen', value: 89000, products: ['eCourt Integration', 'Payment Portal', 'Smart Gateway', 'EPOS'] },
                    { name: 'TechStart Finance', industry: 'Financial Services', manager: 'Emma Williams', value: 250000, products: ['P2PE (TMS)', 'Stored Card', 'Mobile SDK', 'ApplePay/GooglePay'] }
                ];
                const existing = getAllOnboardings();
                sampleCompanies.forEach((company, idx) => {
                    const id = `ONB-SMPL${String(idx + 1).padStart(3, '0')}`;
                    if (!existing.find(e => e.id === id)) {
                        existing.push({
                            id, accountName: company.name, accountNumber: `ACC${10000 + idx}`,
                            industry: company.industry, accountManager: company.manager, products: company.products,
                            contractValue: company.value, startDate: '2025-03-15', billingFrequency: 'Quarterly',
                            paymentMethod: 'Direct Debit', technicalContact: 'Tech Contact',
                            technicalEmail: 'tech@example.com', businessContact: 'Business Contact',
                            businessEmail: 'business@example.com', notes: '', submittedAt: new Date().toISOString(),
                            status: 'Active'
                        });
                    }
                });
                localStorage.setItem('onboardings', JSON.stringify(existing));
                window.location.reload();
            };

            const exportToExcel = () => {
                const data = getAllOnboardings();
                if (data.length === 0) { alert('No data to export'); return; }
                const headers = ['ID', 'Name', 'Number', 'Industry', 'Manager', 'Value', 'Start Date', 'Billing', 'Payment', 'Tech Contact', 'Tech Email', 'Biz Contact', 'Biz Email', 'Products', 'Status', 'Submitted', 'Notes'];
                const csvRows = [headers.join(',')];
                data.forEach(row => {
                    const values = [
                        row.id || '', `"${row.accountName || ''}"`, row.accountNumber || '', row.industry || '',
                        row.accountManager || '', row.contractValue || '', row.startDate || '', row.billingFrequency || '',
                        row.paymentMethod || '', row.technicalContact || '', row.technicalEmail || '',
                        row.businessContact || '', row.businessEmail || '', `"${(row.products || []).join('; ')}"`,
                        row.status || '', row.submittedAt || '', `"${(row.notes || '').replace(/"/g, '""')}"`
                    ];
                    csvRows.push(values.join(','));
                });
                const blob = new Blob([csvRows.join('\n')], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `customers_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };

            const importFromExcel = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const text = e.target.result;
                        const rows = text.split('\n').slice(1).filter(row => row.trim());
                        const existingData = getAllOnboardings();
                        rows.forEach(row => {
                            const cols = [];
                            let current = '', inQuotes = false;
                            for (let char of row) {
                                if (char === '"') inQuotes = !inQuotes;
                                else if (char === ',' && !inQuotes) { cols.push(current.trim()); current = ''; }
                                else current += char;
                            }
                            cols.push(current.trim());
                            if (cols.length >= 14) {
                                const newRecord = {
                                    id: cols[0] || `ONB-${Date.now()}`, accountName: cols[1].replace(/^"|"$/g, ''),
                                    accountNumber: cols[2], industry: cols[3], accountManager: cols[4],
                                    contractValue: cols[5], startDate: cols[6], billingFrequency: cols[7],
                                    paymentMethod: cols[8], technicalContact: cols[9], technicalEmail: cols[10],
                                    businessContact: cols[11], businessEmail: cols[12],
                                    products: cols[13].replace(/^"|"$/g, '').split(';').map(p => p.trim()).filter(p => p),
                                    status: cols[14] || 'Pending Implementation', submittedAt: cols[15] || new Date().toISOString(),
                                    notes: cols[16] ? cols[16].replace(/^"|"$/g, '').replace(/""/g, '"') : ''
                                };
                                const existingIndex = existingData.findIndex(d => d.id === newRecord.id);
                                if (existingIndex >= 0) existingData[existingIndex] = newRecord;
                                else existingData.push(newRecord);
                            }
                        });
                        localStorage.setItem('onboardings', JSON.stringify(existingData));
                        alert(`Imported ${rows.length} records!`);
                        window.location.reload();
                    } catch (error) { alert('Error importing file'); }
                };
                reader.readAsText(file);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow-sm p-6 mb-6" style={{borderTop: '4px solid #2a5c59'}}>
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-800">Customer Onboarding</h1>
                                    <p className="text-gray-600 mt-1">Manage your customer onboarding process</p>
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={() => { setViewMode('form'); setIsSubmitted(false); setSelectedCustomer(null); }} className={`px-6 py-3 rounded-lg font-semibold ${viewMode === 'form' ? 'text-white' : 'bg-gray-200 text-gray-700'}`} style={viewMode === 'form' ? {backgroundColor: '#2a5c59'} : {}}>New Onboarding</button>
                                    <button onClick={() => { setViewMode('list'); setSelectedCustomer(null); }} className={`px-6 py-3 rounded-lg font-semibold ${viewMode === 'list' ? 'text-white' : 'bg-gray-200 text-gray-700'}`} style={viewMode === 'list' ? {backgroundColor: '#2a5c59'} : {}}>Customer List</button>
                                    <button onClick={() => { setViewMode('timeline'); setSelectedCustomer(null); }} className={`px-6 py-3 rounded-lg font-semibold ${viewMode === 'timeline' ? 'text-white' : 'bg-gray-200 text-gray-700'}`} style={viewMode === 'timeline' ? {backgroundColor: '#2a5c59'} : {}}>Master Timeline</button>
                                </div>
                            </div>
                        </div>

                        {/* The rest of the UI would go here - this is a simplified working version */}
                        <div className="bg-white rounded-lg shadow-sm p-8 text-center">
                            <h2 className="text-2xl font-bold mb-4" style={{color: '#2a5c59'}}>Welcome to Customer Onboarding</h2>
                            <p className="text-gray-600 mb-6">Your app is successfully deployed! Click the buttons above to navigate.</p>
                            <button onClick={generateSampleData} className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">Load Sample Data</button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<OnboardingApp />);
    </script>
</body>
</html>
