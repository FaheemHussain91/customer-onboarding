<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Onboarding</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        const Check = ({ size = 24, className = "", strokeWidth = 2 }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );
        const X = ({ size = 24, className = "", strokeWidth = 2 }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );
        const ChevronRight = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );
        const ChevronLeft = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        );

        const OnboardingApp = () => {
            const [currentStep, setCurrentStep] = useState(0);
            const [isSubmitted, setIsSubmitted] = useState(false);
            const [onboardingId, setOnboardingId] = useState(null);
            const [viewMode, setViewMode] = useState('home');
            const [selectedCustomer, setSelectedCustomer] = useState(null);
            
            const [products, setProducts] = useState([
                'Maintenance Extension', 'Translation', 'Income Management', 'Income Reconciliation',
                'Updates (v14 or v15)', 'eCourt Integration', 'Payacre', 'Call Secure/Call Secure Plus',
                'Knoydart / Call Secure', 'Payment Portal', 'Stored Card', 'P2PE (TMS)', 'eReturns',
                'Touch Tone', 'Instant Payments', 'SC Payment Portal', 'PRM-CBI', 'TP Trading Banking',
                'Smart Gateway', 'Smart Mobile', 'eSkog', 'Direct Debits', 'POPP', 'EPOS',
                'Jammie-Kelly', 'Optimize Fraud', 'ApplePay/GooglePay', 'Mobile SDK'
            ]);
            
            const [showProductManager, setShowProductManager] = useState(false);
            const [newProduct, setNewProduct] = useState('');
            
            const [formData, setFormData] = useState({
                accountName: '', accountNumber: '', industry: '', accountManager: '', products: [],
                contractValue: '', startDate: '', billingFrequency: '', paymentMethod: '',
                technicalContact: '', technicalEmail: '', businessContact: '', businessEmail: '',
                notes: '', status: 'Pending Implementation'
            });

            const industries = ['Healthcare', 'Education', 'Retail', 'Public Sector', 'Financial Services', 'Other'];
            const billingFrequencies = ['Monthly', 'Quarterly', 'Annually'];
            const paymentMethods = ['Direct Debit', 'Credit Card', 'Bank Transfer', 'Invoice'];
            const statuses = ['Pending Implementation', 'In Implementation', 'Active', 'On Hold', 'Churned'];
            
            const steps = [
                { title: 'Account Info', icon: '1' }, { title: 'Products', icon: '2' },
                { title: 'Commercial', icon: '3' }, { title: 'Contacts', icon: '4' }, { title: 'Review', icon: '5' }
            ];

            const handleInputChange = (field, value) => setFormData(prev => ({ ...prev, [field]: value }));
            
            const handleProductToggle = (product) => {
                setFormData(prev => ({
                    ...prev, products: prev.products.includes(product) ? prev.products.filter(p => p !== product) : [...prev.products, product]
                }));
            };
            
            const addNewProduct = () => {
                if (newProduct.trim() && !products.includes(newProduct.trim())) {
                    setProducts([...products, newProduct.trim()]);
                    setNewProduct('');
                }
            };
            
            const removeProduct = (productToRemove) => {
                setProducts(products.filter(p => p !== productToRemove));
                setFormData(prev => ({ ...prev, products: prev.products.filter(p => p !== productToRemove) }));
            };

            const nextStep = () => { if (currentStep < steps.length - 1) setCurrentStep(currentStep + 1); };
            const prevStep = () => { if (currentStep > 0) setCurrentStep(currentStep - 1); };

            const handleSubmit = () => {
                const newId = 'ONB-' + Date.now().toString().slice(-8);
                setOnboardingId(newId);
                const onboardingData = { id: newId, ...formData, submittedAt: new Date().toISOString() };
                const existingData = JSON.parse(localStorage.getItem('onboardings') || '[]');
                existingData.push(onboardingData);
                localStorage.setItem('onboardings', JSON.stringify(existingData));
                setIsSubmitted(true);
            };

            const resetForm = () => {
                setFormData({
                    accountName: '', accountNumber: '', industry: '', accountManager: '', products: [],
                    contractValue: '', startDate: '', billingFrequency: '', paymentMethod: '',
                    technicalContact: '', technicalEmail: '', businessContact: '', businessEmail: '',
                    notes: '', status: 'Pending Implementation'
                });
                setCurrentStep(0); setIsSubmitted(false); setOnboardingId(null); setViewMode('home');
            };

            const getAllOnboardings = () => JSON.parse(localStorage.getItem('onboardings') || '[]');
            
            const exportToExcel = () => {
                const data = getAllOnboardings();
                if (data.length === 0) { alert('No data to export'); return; }
                const headers = ['ID', 'Name', 'Number', 'Industry', 'Manager', 'Value', 'Start Date', 'Billing', 'Payment', 'Tech Contact', 'Tech Email', 'Biz Contact', 'Biz Email', 'Products', 'Status', 'Submitted', 'Notes'];
                const csvRows = [headers.join(',')];
                data.forEach(row => {
                    const values = [
                        row.id || '', `"${row.accountName || ''}"`, row.accountNumber || '', row.industry || '',
                        row.accountManager || '', row.contractValue || '', row.startDate || '', row.billingFrequency || '',
                        row.paymentMethod || '', row.technicalContact || '', row.technicalEmail || '',
                        row.businessContact || '', row.businessEmail || '', `"${(row.products || []).join('; ')}"`,
                        row.status || '', row.submittedAt || '', `"${(row.notes || '').replace(/"/g, '""')}"`
                    ];
                    csvRows.push(values.join(','));
                });
                const blob = new Blob([csvRows.join('\n')], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `customers_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };

            const importFromExcel = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const text = e.target.result;
                        const rows = text.split('\n').slice(1).filter(row => row.trim());
                        const existingData = getAllOnboardings();
                        rows.forEach(row => {
                            const cols = [];
                            let current = '', inQuotes = false;
                            for (let char of row) {
                                if (char === '"') inQuotes = !inQuotes;
                                else if (char === ',' && !inQuotes) { cols.push(current.trim()); current = ''; }
                                else current += char;
                            }
                            cols.push(current.trim());
                            if (cols.length >= 14) {
                                const newRecord = {
                                    id: cols[0] || `ONB-${Date.now()}`, accountName: cols[1].replace(/^"|"$/g, ''),
                                    accountNumber: cols[2], industry: cols[3], accountManager: cols[4],
                                    contractValue: cols[5], startDate: cols[6], billingFrequency: cols[7],
                                    paymentMethod: cols[8], technicalContact: cols[9], technicalEmail: cols[10],
                                    businessContact: cols[11], businessEmail: cols[12],
                                    products: cols[13].replace(/^"|"$/g, '').split(';').map(p => p.trim()).filter(p => p),
                                    status: cols[14] || 'Pending Implementation', submittedAt: cols[15] || new Date().toISOString(),
                                    notes: cols[16] ? cols[16].replace(/^"|"$/g, '').replace(/""/g, '"') : ''
                                };
                                const existingIndex = existingData.findIndex(d => d.id === newRecord.id);
                                if (existingIndex >= 0) existingData[existingIndex] = newRecord;
                                else existingData.push(newRecord);
                            }
                        });
                        localStorage.setItem('onboardings', JSON.stringify(existingData));
                        alert(`Imported ${rows.length} records!`);
                        window.location.reload();
                    } catch (error) { alert('Error importing file'); }
                };
                reader.readAsText(file);
            };

            // HOME VIEW
            if (viewMode === 'home') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
                        <div className="max-w-7xl mx-auto">
                            <div className="bg-white rounded-lg shadow-sm p-6 mb-6" style={{borderTop: '4px solid #2a5c59'}}>
                                <div className="flex justify-between items-center">
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-800">Customer Onboarding</h1>
                                        <p className="text-gray-600 mt-1">Manage your customer onboarding process</p>
                                    </div>
                                    <div className="flex gap-3">
                                        <button onClick={() => setViewMode('form')} className="px-6 py-3 rounded-lg font-semibold text-white" style={{backgroundColor: '#2a5c59'}}>New Onboarding</button>
                                        <button onClick={() => setViewMode('list')} className="px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700">Customer List</button>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow-sm p-12 text-center">
                                <h2 className="text-3xl font-bold mb-4" style={{color: '#2a5c59'}}>Welcome</h2>
                                <p className="text-gray-600 mb-8 text-lg">Get started by creating a new onboarding or importing your data</p>
                                <div className="grid grid-cols-2 gap-6 max-w-2xl mx-auto">
                                    <div className="border-2 border-gray-300 rounded-lg p-6 hover:border-teal-600 transition-all cursor-pointer" onClick={() => setViewMode('form')}>
                                        <h3 className="font-bold text-xl mb-2">Create New</h3>
                                        <p className="text-gray-600 text-sm mb-4">Start onboarding a new customer</p>
                                        <button className="px-6 py-2 text-white rounded-lg font-semibold" style={{backgroundColor: '#2a5c59'}}>Start Onboarding</button>
                                    </div>
                                    <div className="border-2 border-gray-300 rounded-lg p-6 hover:border-teal-600 transition-all">
                                        <h3 className="font-bold text-xl mb-2">Import Data</h3>
                                        <p className="text-gray-600 text-sm mb-4">Upload your customer CSV file</p>
                                        <input type="file" accept=".csv" onChange={importFromExcel} style={{display: 'none'}} id="fileInput" />
                                        <button onClick={() => document.getElementById('fileInput').click()} className="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold">Choose File</button>
                                    </div>
                                </div>
                                {getAllOnboardings().length > 0 && (
                                    <div className="mt-8 p-4 bg-green-50 border border-green-200 rounded-lg max-w-2xl mx-auto">
                                        <p className="text-green-800 font-semibold">✓ You have {getAllOnboardings().length} customers</p>
                                        <button onClick={() => setViewMode('list')} className="mt-2 text-teal-700 font-semibold">View List →</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // FORM VIEW - placeholder for now
            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                            <button onClick={() => setViewMode('home')} className="text-gray-600 hover:text-gray-800">← Back to Home</button>
                        </div>
                        <div className="bg-white rounded-lg shadow-sm p-8">
                            <h2 className="text-2xl font-bold mb-4">Onboarding Form</h2>
                            <p className="text-gray-600">Form view - Step {currentStep + 1} of {steps.length}</p>
                            <p className="text-sm text-gray-500 mt-4">Full form coming in next update...</p>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<OnboardingApp />);
    </script>
</body>
</html>